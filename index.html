<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hacker News Explorer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f2f5;
            padding-top: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .story-card {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        .story-card:hover {
            transform: translateY(-5px);
        }
        .story-title {
            color: #1a1a1a;
            text-decoration: none;
            font-weight: 600;
        }
        .story-title:hover {
            color: #ff6600;
        }
        .story-meta {
            font-size: 0.9rem;
            color: #666;
        }
        .story-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        .story-content {
            padding: 20px;
        }
        .story-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .story-stat {
            display: flex;
            align-items: center;
        }
        .story-stat i {
            margin-right: 5px;
            color: #ff6600;
        }
        #load-more {
            background-color: #ff6600;
            border: none;
            padding: 10px 20px;
            font-weight: 600;
        }
        #load-more:hover {
            background-color: #e65c00;
        }
        .date-header {
            background-color: #ff6600;
            color: white;
            padding: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-weight: bold;
        }
        .nav-tabs .nav-link {
            color: #495057;
            background-color: #f8f9fa;
            border-color: #dee2e6 #dee2e6 #fff;
        }
        .nav-tabs .nav-link.active {
            color: #ff6600;
            background-color: #fff;
            border-color: #dee2e6 #dee2e6 #fff;
            font-weight: bold;
        }
        .spinner-border {
            color: #ff6600;
            width: 3rem;
            height: 3rem;
        }

        #spinner-container {
            display: none;
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4 text-center">Hacker News Explorer</h1>
        <ul class="nav nav-tabs mb-4" id="storyTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="today-tab" data-bs-toggle="tab" data-bs-target="#today" type="button" role="tab" aria-controls="today" aria-selected="true">Today</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="yesterday-tab" data-bs-toggle="tab" data-bs-target="#yesterday" type="button" role="tab" aria-controls="yesterday" aria-selected="false">Yesterday</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="older-tab" data-bs-toggle="tab" data-bs-target="#older" type="button" role="tab" aria-controls="older" aria-selected="false">Older</button>
            </li>
        </ul>
        <div id="spinner-container">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading stories...</p>
        </div>
        <div class="tab-content" id="storyTabContent">
            <div class="tab-pane fade show active" id="today" role="tabpanel" aria-labelledby="today-tab">
                <div id="today-stories" class="row"></div>
            </div>
            <div class="tab-pane fade" id="yesterday" role="tabpanel" aria-labelledby="yesterday-tab">
                <div id="yesterday-stories" class="row"></div>
            </div>
            <div class="tab-pane fade" id="older" role="tabpanel" aria-labelledby="older-tab">
                <div id="older-stories" class="row"></div>
            </div>
        </div>
        <div class="text-center mt-4 mb-5">
            <button id="load-more" class="btn btn-primary">Load More Stories</button>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script>
        $(document).ready(function() {
            let lastLoadedIndex = 0;
            const storiesPerLoad = 30;
            const imageCategories = ['technology', 'business', 'science', 'nature', 'abstract'];

            function showSpinner() {
                $('#spinner-container').show();
                $('#load-more').prop('disabled', true);
            }

            function hideSpinner() {
                $('#spinner-container').hide();
                $('#load-more').prop('disabled', false);
            }

            function getUniqueImage(storyId) {
                const category = imageCategories[storyId % imageCategories.length];
                return `https://source.unsplash.com/300x200/?${category},${storyId}`;
            }

            function getDateCategory(timestamp) {
                const now = moment();
                const storyDate = moment.unix(timestamp);
                if (storyDate.isSame(now, 'day')) {
                    return 'Today';
                } else if (storyDate.isSame(now.clone().subtract(1, 'day'), 'day')) {
                    return 'Yesterday';
                } else {
                    return 'Older';
                }
            }

            function renderStory(story) {
                const storyTime = moment.unix(story.time).fromNow();
                const domain = story.url ? new URL(story.url).hostname : 'news.ycombinator.com';
                const imageUrl = getUniqueImage(story.id);
                return `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="story-card h-100">
                            <img src="${imageUrl}" class="story-image" alt="Story image" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200?text=No+Image';">
                            <div class="story-content">
                                <h5><a href="${story.url || `https://news.ycombinator.com/item?id=${story.id}`}" class="story-title" target="_blank">${story.title}</a></h5>
                                <p class="story-meta mb-2">
                                    <i class="fas fa-user"></i> ${story.by} | 
                                    <i class="fas fa-globe"></i> ${domain} | 
                                    <i class="fas fa-clock"></i> ${storyTime}
                                </p>
                                <div class="story-stats">
                                    <span class="story-stat"><i class="fas fa-star"></i> ${story.score} points</span>
                                    <span class="story-stat"><i class="fas fa-comments"></i> ${story.descendants || 0} comments</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function fetchStories() {
                showSpinner();
                $.get("https://hacker-news.firebaseio.com/v0/topstories.json", function(storyIds) {
                    const storiesToLoad = storyIds.slice(lastLoadedIndex, lastLoadedIndex + storiesPerLoad);
                    lastLoadedIndex += storiesPerLoad;

                    const storyPromises = storiesToLoad.map(storyId => 
                        $.get(`https://hacker-news.firebaseio.com/v0/item/${storyId}.json`)
                    );

                    Promise.all(storyPromises).then(stories => {
                        stories.forEach(story => {
                            const category = getDateCategory(story.time);
                            const storyHtml = renderStory(story);
                            $(`#${category.toLowerCase()}-stories`).append(storyHtml);
                        });

                        if (lastLoadedIndex >= storyIds.length) {
                            $('#load-more').hide();
                        }
                        hideSpinner();
                    });
                }).fail(function() {
                    $('#stories-container').html("<p class='text-center'>Failed to fetch stories. Please try again.</p>");
                    hideSpinner();
                });
            }

            // Initial stories fetch
            fetchStories();

            // Load more button
            $('#load-more').click(fetchStories);
        });
    </script>
</body>
</html>