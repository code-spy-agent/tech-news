<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechPulse - Latest IT Updates</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --background-color: #f4f6f9;
            --card-background: #ffffff;
            --text-color: #333333;
            --light-text-color: #777777;
            --border-color: #e0e0e0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .navbar {
            background-color: var(--secondary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }

        .story-card {
            background-color: var(--card-background);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
            height: 100%;
        }

        .story-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .story-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .story-content {
            padding: 20px;
        }

        .story-title {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: block;
            line-height: 1.4;
        }

        .story-title:hover {
            color: var(--primary-color);
        }

        .story-meta {
            font-size: 0.85rem;
            color: var(--light-text-color);
            margin-bottom: 15px;
        }

        .story-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--light-text-color);
        }

        .story-stat i {
            color: var(--primary-color);
            margin-right: 5px;
        }

        .filter-btn {
            margin-right: 10px;
            margin-bottom: 10px;
            border-radius: 20px;
            padding: 8px 16px;
        }

        #loading-trigger {
            height: 1px;
            width: 100%;
        }

        .top-stories {
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .top-story {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .top-story:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .top-story-title {
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 5px;
            line-height: 1.4;
            color: var(--text-color);
            text-decoration: none;
        }

        .top-story-title:hover {
            color: var(--primary-color);
        }

        .top-story-meta {
            font-size: 0.8rem;
            color: var(--light-text-color);
        }

        .section-title {
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--secondary-color);
        }

        .main-content {
            margin-bottom: 2rem;
        }

        .side-content {
            position: sticky;
            top: 20px;
        }

        @media (min-width: 992px) {
            .main-content {
                flex: 0 0 auto;
                width: 75%;
            }

            .side-content {
                flex: 0 0 auto;
                width: 25%;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">TechPulse</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="main-content">
                <section id="home">
                    <h1 class="section-title">Latest IT Updates</h1>
                    <div class="mb-4">
                        <button class="btn btn-primary filter-btn" data-filter="all">All</button>
                        <button class="btn btn-outline-primary filter-btn" data-filter="today">Today</button>
                        <button class="btn btn-outline-primary filter-btn" data-filter="yesterday">Yesterday</button>
                        <button class="btn btn-outline-primary filter-btn" data-filter="older">Older</button>
                    </div>
                    <div id="stories-container">
                        <!-- Stories will be dynamically inserted here -->
                    </div>
                    <div id="loading-trigger"></div>
                </section>
            </div>
            <div class="side-content">
                <div class="top-stories">
                    <h3 class="section-title">Today's Top Stories</h3>
                    <div id="top-stories-container">
                        <!-- Top stories will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <section id="about" class="mt-5 pt-5">
            <h2 class="section-title">About TechPulse</h2>
            <p>TechPulse is your go-to source for the latest updates in the world of Information Technology. We curate and deliver the most relevant and impactful news from various trusted sources, keeping you informed about the rapidly evolving tech landscape.</p>
            <p>Our mission is to empower tech enthusiasts, professionals, and decision-makers with timely and accurate information, helping them stay ahead in the fast-paced world of technology.</p>
        </section>

        <section id="contact" class="mt-5 pt-5">
            <h2 class="section-title">Contact Us</h2>
            <p>We'd love to hear from you! Whether you have a question, feedback, or a suggestion, feel free to reach out to us using the form below.</p>
            <form>
                <div class="mb-3">
                    <label for="name" class="form-label">Name</label>
                    <input type="text" class="form-control" id="name" required>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email address</label>
                    <input type="email" class="form-control" id="email" required>
                </div>
                <div class="mb-3">
                    <label for="message" class="form-label">Message</label>
                    <textarea class="form-control" id="message" rows="5" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Send Message</button>
            </form>
        </section>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script>
        $(document).ready(function() {
            let lastLoadedIndex = 0;
            const storiesPerLoad = 30;
            let allStories = [];
            let currentFilter = 'all';
            let isLoading = false;

            function getImageUrl() {
                return `https://picsum.photos/300/200?random=${Math.random()}`;
            }

            function renderStory(story) {
                const storyTime = moment.unix(story.time);
                const timeAgo = storyTime.fromNow();
                const domain = story.url ? new URL(story.url).hostname : 'news.ycombinator.com';
                const imageUrl = getImageUrl();
                return `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="story-card">
                            <img src="${imageUrl}" class="story-image" alt="Story image" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200?text=No+Image';">
                            <div class="story-content">
                                <a href="${story.url || `https://news.ycombinator.com/item?id=${story.id}`}" class="story-title" target="_blank">${story.title}</a>
                                <p class="story-meta">
                                    <i class="fas fa-user"></i> ${story.by} &bull; 
                                    <i class="fas fa-globe"></i> ${domain} &bull; 
                                    <i class="fas fa-clock"></i> ${timeAgo}
                                </p>
                                <div class="story-stats">
                                    <span class="story-stat"><i class="fas fa-star"></i> ${story.score} points</span>
                                    <span class="story-stat"><i class="fas fa-comments"></i> ${story.descendants || 0} comments</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderLoadingPlaceholders() {
                let placeholders = '';
                for (let i = 0; i < storiesPerLoad; i++) {
                    placeholders += `
                        <div class="col-md-6 col-lg-4 mb-4 loading-placeholder">
                            <div class="story-card">
                                <div class="story-image placeholder-glow">
                                    <span class="placeholder col-12" style="height: 200px;"></span>
                                </div>
                                <div class="story-content">
                                    <span class="placeholder col-6"></span>
                                    <span class="placeholder col-8"></span>
                                    <span class="placeholder col-7"></span>
                                    <div class="story-stats">
                                        <span class="placeholder col-4"></span>
                                        <span class="placeholder col-4"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                return placeholders;
            }

            function getDateCategory(timestamp) {
                const storyDate = moment.unix(timestamp).startOf('day');
                const today = moment().startOf('day');
                const yesterday = moment().subtract(1, 'days').startOf('day');

                if (storyDate.isSame(today)) {
                    return 'Today';
                } else if (storyDate.isSame(yesterday)) {
                    return 'Yesterday';
                } else {
                    return 'Older';
                }
            }

            function renderTopStory(story) {
                return `
                    <div class="top-story">
                        <a href="${story.url || `https://news.ycombinator.com/item?id=${story.id}`}" class="top-story-title" target="_blank">${story.title}</a>
                        <div class="top-story-meta">
                            <span><i class="fas fa-star"></i> ${story.score} points</span> &bull;
                            <span><i class="fas fa-user"></i> ${story.by}</span>
                        </div>
                    </div>
                `;
            }

            function fetchTopStories() {
                $.ajax({
                    url: "https://hacker-news-server-6dzb.onrender.com/api/top-stories",
                    method: "GET",
                    success: function(storyIds) {
                        const storiesToFetch = storyIds.slice(0, 30);
                        const storyPromises = storiesToFetch.map(id => 
                            $.get(`https://hacker-news-server-6dzb.onrender.com/api/item/${id}`)
                        );

                        Promise.all(storyPromises)
                            .then(stories => {
                                const todayStories = stories.filter(story => getDateCategory(story.time) === 'Today');
                                const topTenStories = todayStories.sort((a, b) => b.score - a.score).slice(0, 10);
                                const topStoriesHtml = topTenStories.map(renderTopStory).join('');
                                $('#top-stories-container').html(topStoriesHtml);
                            })
                            .catch(error => {
                                $('#top-stories-container').html("<p class='text-danger'>Failed to fetch top stories. Please try again.</p>");
                            });
                    },
                    error: function() {
                        $('#top-stories-container').html("<p class='text-danger'>Failed to fetch top stories. Please try again.</p>");
                    }
                });
            }

            function fetchStories() {
                if (isLoading) return;
                isLoading = true;

                const loadingPlaceholders = renderLoadingPlaceholders();
                $('#stories-container').append('<div class="row">' + loadingPlaceholders + '</div>');

                $.ajax({
                    url: "https://hacker-news-server-6dzb.onrender.com/api/top-stories",
                    method: "GET",
                    success: function(storyIds) {
                        const storiesToFetch = storyIds.slice(lastLoadedIndex, lastLoadedIndex + storiesPerLoad);
                        const storyPromises = storiesToFetch.map(id => 
                            $.get(`https://hacker-news-server-6dzb.onrender.com/api/item/${id}`)
                        );

                        Promise.all(storyPromises)
                            .then(stories => {
                                allStories = allStories.concat(stories);
                                lastLoadedIndex += stories.length;
                                filterAndRenderStories(stories);
                                $('.loading-placeholder').remove();
                                isLoading = false;
                            })
                            .catch(error => {
                                $('.loading-placeholder').replaceWith("<p class='text-center text-danger'>Failed to process stories. Please try again.</p>");
                                isLoading = false;
                            });
                    },
                    error: function() {
                        $('.loading-placeholder').replaceWith("<p class='text-center text-danger'>Failed to fetch stories. Please try again.</p>");
                        isLoading = false;
                    }
                });
            }

            function filterAndRenderStories(newStories) {
                const filteredStories = newStories.filter(story => {
                    const category = getDateCategory(story.time);
                    return currentFilter === 'all' || category.toLowerCase() === currentFilter;
                });

                const storiesHtml = filteredStories.map(renderStory).join('');
                $('#stories-container').append('<div class="row">' + storiesHtml + '</div>');
            }

            // Initial load
            fetchStories();
            fetchTopStories();

            // Handle filter buttons
            $('.filter-btn').on('click', function() {
                currentFilter = $(this).data('filter');
                $('.filter-btn').removeClass('btn-primary').addClass('btn-outline-primary');
                $(this).removeClass('btn-outline-primary').addClass('btn-primary');
                $('#stories-container').empty();
                lastLoadedIndex = 0;
                allStories = [];
                fetchStories();
            });

            // Implement infinite scroll
            $(window).scroll(function() {
                if ($(window).scrollTop() + $(window).height() > $(document).height() - 100) {
                    fetchStories();
                }
            });

            // Handle main navigation
            $('a.nav-link').on('click', function(e) {
                e.preventDefault();
                const targetId = $(this).attr('href');
                $('section').hide();
                $(targetId).show();
                $('a.nav-link').removeClass('active');
                $(this).addClass('active');
            });

            // Show home section by default
            $('section').hide();
            $('#home').show();
        });
    </script>
</body>
</html>
